<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7">
<title>Zimbra Collaboration Reference Architecture</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Zimbra Collaboration Reference Architecture</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">Overview</a>
<ul class="sectlevel2">
<li><a href="#_introduction_and_scope">Introduction and Scope</a></li>
<li><a href="#_intended_audience">Intended Audience</a></li>
<li><a href="#_services_to_be_deployed">Services to Be Deployed</a></li>
</ul>
</li>
<li><a href="#_sizing_assumptions">Sizing Assumptions</a>
<ul class="sectlevel2">
<li><a href="#_overview_2">Overview</a></li>
<li><a href="#_users_and_mailbox_sizes">Users and Mailbox Sizes</a></li>
</ul>
</li>
<li><a href="#_role_based_server_hardware_configuration_and_placement">Role Based Server Hardware Configuration and Placement</a></li>
<li><a href="#_virtualization_strategy">Virtualization Strategy</a>
<ul class="sectlevel2">
<li><a href="#_memory_allocation">Memory Allocation</a></li>
</ul>
</li>
<li><a href="#_storage_design">Storage Design</a>
<ul class="sectlevel3">
<li><a href="#_minimum_number_of_disk_spindles_for_primary_partition_store_index_db_redologtable">Minimum Number of Disk Spindles for Primary Partition (store, index, db, redolog)	Table</a></li>
<li><a href="#_minimum_number_of_disk_spindles_for_backup_partition_optzimbrabackuptable">Minimum Number of Disk Spindles for Backup Partition (/opt/zimbra/backup)	Table</a></li>
<li><a href="#_file_system_setup">File System Setup</a></li>
<li><a href="#_proxymta_usable_storage">Proxy/MTA Usable Storage</a></li>
<li><a href="#_mail_store">Mail Store</a></li>
<li><a href="#_archive_store_optional">Archive Store (Optional)</a></li>
</ul>
</li>
<li><a href="#_network_design">Network Design</a>
<ul class="sectlevel2">
<li><a href="#_mail_flow">Mail Flow</a></li>
<li><a href="#_host_file">Host File</a></li>
<li><a href="#_external_connectivity_load_balancer">External Connectivity – Load Balancer</a></li>
<li><a href="#_firewall_port_configuration">Firewall Port Configuration</a></li>
</ul>
</li>
<li><a href="#_high_availability_considerations">High Availability Considerations</a>
<ul class="sectlevel2">
<li><a href="#_ldap_servers">LDAP Servers</a></li>
<li><a href="#_proxymta_servers">Proxy/MTA Servers</a></li>
<li><a href="#_mailbox_servers">Mailbox Servers</a></li>
</ul>
</li>
<li><a href="#_backup_storage_sizing">Backup Storage Sizing</a></li>
<li><a href="#_archiving_or_e_discovery">Archiving or E-discovery</a></li>
<li><a href="#_split_domain_strategy">Split Domain Strategy</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_overview">Overview</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_and_scope">Introduction and Scope</h3>
<div class="paragraph">
<p>This technical white paper describes a sample reference architecture for a Zimbra Collaboration Suite (ZCS) implementation based on the typical usage patterns for Small to Medium Business (SMB/SME) customer with approximately 1,000 users. This document should not be used to extrapolate to larger deployments or beyond the parameters show in <a href="#table_sizing_assumptions">Table 1</a> of the Sizing Assumptions. The configurations shown will work for physical or virtual server deployments. However, Zimbra recommends a virtualized deployment for the SMB customer.</p>
</div>
<div class="paragraph">
<p>This document does not cover detailed information about the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OS level selection or configuration.</p>
</li>
<li>
<p>Storage Area Network (SAN) configuration.</p>
</li>
<li>
<p>Vendor-specific requirements with hardware.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Integration requirements are discussed for a Split-Domain configuration, but other integration requirements such as provisioning, application SMTP connectivity, etc. are not discussed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Three (3) scenarios are shown for customers that fall into categories of small, medium, or heavy email usage. The usage patterns referred to are based on email volumes (number of messages sent and received) and hardware performance typically found in SMB business environments.  Messaging system administrators should use the appropriate tools within their legacy environment to confirm their parameters fall into one of these categories. While ZCS can easily support a typical configuration on a single physical server, today’s SMB customers can take advantage of Zimbra’s architectural features such as proxy services and redundant MTA’s deployed in virtualized configurations to increase availability and flexibility in deployment options.</p>
</div>
<div class="paragraph">
<p>A highly available, cost effective infrastructure for email and collaboration can be achieved with Zimbra when used in conjunction with a virtualized infrastructure.</p>
</div>
<div class="paragraph">
<p>Many SMB/SME&#8217;s today do not require archiving solutions. However, Archiving has been included in this architecture to demonstrate how it can be easily added to support <em class="line-through">litigation hold or</em> discovery requirements.</p>
</div>
<div class="paragraph line-through">
<p><em>The ZCS deployment is for the following solution requirements:</em>  <strong><code>-&#8594; change</code></strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Email, Address Book, Calendar, and Shared Documents and Folders.</p>
</li>
<li>
<p>Easy scalability.</p>
</li>
<li>
<p>Utilization of High Availability through vSphere and redundant services.</p>
</li>
<li>
<p>Superior user experience.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong><code>-&#8594; change</code></strong> Installations of Zimbra in the SMB environment may require support of split domain mail routing during a migration period from legacy platforms to Zimbra or will migrate using the flash-cut approach.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Split Domain configuration for email delivery enables email users in a single domain to reside on different email systems and allows for incremental migrations from a legacy platform to a new platform. During the migration process, one system is designated as the “primary” mail system and is responsible for receiving and routing mail for the domain (for example: <em>zm-train.com</em>). The other system is considered the “secondary” mail system.  Split domain configurations and information about migration tools are covered elsewhere.</p>
</li>
<li>
<p><em>“Flash-cut”</em> refers to moving all users from the legacy environment to Zimbra during the shortest time frame possible.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_intended_audience">Intended Audience</h3>
<div class="paragraph">
<p>This document is intended to be used by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IT System Administrators with good messaging experience</p>
</li>
<li>
<p>Zimbra Partners</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_services_to_be_deployed">Services to Be Deployed</h3>
<div class="paragraph">
<p>In most cases, services deployed on legacy email platforms must be supported on Zimbra. While not all deployments require all services, this architecture assumes you will need to support the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HTTPS</p>
</li>
<li>
<p>POP3/POP3S</p>
</li>
<li>
<p>IMAP/IMAPS</p>
</li>
<li>
<p>SMTP</p>
</li>
<li>
<p>Mobile Connectivity (ActiveSync based devices)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Users typically access a Zimbra implementation through the Zimbra Web Client (ZWC). They may also connect to the environment through multiple clients, which are listed below. ZCS <em class="line-through">supports connectivity through multiple clients and</em> can be configured to support most standards based clients. The Zimbra Proxy service can provide connectivity for most clients to both the Zimbra Collaboration Server and legacy platforms during the migration phase if needed.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zimbra Desktop &amp; Zimbra Connector for Outlook (ZCO): If a customer requires offline access to collaboration functionality during travel or network outages, Zimbra Desktop or Outlook with ZCO may be deployed to support this functionality. ZCO communicates with the Zimbra Proxy or Mailbox Server over HTTPS.</p>
</li>
<li>
<p>IMAP: Some customer environments require IMAP access for users or programmatic functions.  This functionality can be provided by the Zimbra environment through standard configuration.</p>
</li>
<li>
<p>Mobile Devices: Mobile connectivity for <em class="line-through">iPhones and Windows Mobile</em> Activesync based devices may be provided using the Zimbra Mobile option. <em class="line-through">A Zimbra specific Blackberry Enterprise Server (BES) running the Zimbra Connector for Blackberry can be established to provide Blackberry connectivity.  Zimbra recommends one BES server for up to 200 BES users.</em></p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sizing_assumptions">Sizing Assumptions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview_2">Overview</h3>
<div class="paragraph">
<p>There are many factors that determine the performance of an email and collaboration deployment.  Inadequate hardware sizing that delivers poor performance can be addressed by adding more servers since the architecture is designed to be scalable. However, it is better to address the issues in the initial design.
The items that impact performance include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number of users during peak utilization</p>
</li>
<li>
<p>Number of messages sent and received</p>
</li>
<li>
<p>Size of messages sent and received</p>
</li>
<li>
<p>Allocated Mailbox size and usage</p>
</li>
<li>
<p>IOPS performance of the disk subsystem</p>
</li>
<li>
<p>Memory Configuration</p>
</li>
<li>
<p>Type of client connecting to the system</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When using this document as a guide, be careful to compare your actual usage values with the assumptions contained here.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_users_and_mailbox_sizes">Users and Mailbox Sizes</h3>
<div class="paragraph">
<p><strong><code>NOTE: Most SMB will have almost all of the users being concurrent as they may be mobile users or use an offline client.</code></strong>
In an average SMB, while there may be 1,000 users, some portion of those email accounts are not being used (active vs. inactive accounts).  Also, at any point in time, there may be less than 50% of the users currently accessing the system (concurrent users).
While mailbox quotas may be set at 5 GB, most users do not use the entire allocated space.  Multiplying the quota by the average utilization gives the average mailbox size.  Higher quotas or higher utilization rates will require more disk space for primary storage and backups. Mailbox sizes have a small impact on day-to-day performance as noted by the client, but mailbox sizes do impact the amount of time required to complete backups.  If your organization uses lower mailbox quotas, less disk space will be required on the Mailbox server.</p>
</div>
<div class="sect3">
<h4 id="_smtp">SMTP</h4>
<div class="paragraph">
<p>SMTP (Simple Mail Transfer Protocol) functionality can be provided with the ZCS MTA service using Postfix or an external MTA service. Along with MTA services, ZCS can provide primary anti-virus and anti-spam functionality for the customer’s messaging environment or it can be provided for inbound email from the Internet by external commercial solutions.  All inbound mail to the environment will flow from the spam filtering device or the Zimbra MTA and be routed to users in the Zimbra environment.
For the average SMB, message delivery is typically distributed during the workday in North America.  However, to calculate the MTA load, assume that peak message delivery occurs during a two hour interval.
In this architecture, the ZCS MTA Service will provide MTA, Anti-virus, and Anti-spam services.</p>
</div>
</div>
<div class="sect3">
<h4 id="_pop">POP</h4>
<div class="paragraph">
<p>POP traffic has a relatively small impact on performance of the ZCS environment. If messages are stored locally by the POP client and not on the server, the amount of required disk space would be reduced and the length of time required for backups would be reduced.</p>
</div>
</div>
<div class="sect3">
<h4 id="_imap">IMAP</h4>
<div class="paragraph">
<p>IMAP can have a significant impact on the ZCS environment, particularly the amount of memory that should be allocated for mysql.  A single mailbox server with 32 GB of RAM will be able to support the message volumes listed here for heavy usage.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sizing_data_table">Sizing Data Table</h4>
<table id="table_sizing_assumptions" class="tableblock frame-all grid-rows" style="width: 60%;">
<caption class="title">Table 1. Sizing Assumptions</caption>
<colgroup>
<col style="width: 52.6315%;">
<col style="width: 15.7894%;">
<col style="width: 15.7894%;">
<col style="width: 15.7897%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Criteria</th>
<th class="tableblock halign-center valign-top">Light</th>
<th class="tableblock halign-center valign-top">Medium</th>
<th class="tableblock halign-center valign-top">Heavy</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Users</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total Users</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Active Users</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">600</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">750</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">900</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concurrent Users</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">300</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">700</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Mailboxes</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mailbox Quota (GB)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Avg. Mailbox Utilization</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">40%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">50%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">60%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Avg. Mailbox Size (GB)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0.8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2.5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">6.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Incoming Mail</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Average Msg. Size (KB)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">175</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">250</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Msgs Per User Per Day</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">50</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">75</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Outgoing Mail</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Avg. Msg. Size (KB)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">175</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">250</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Msgs Per User Per Day</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">50</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">75</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">100</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Peak Period</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peak Period (minutes)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">120</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">120</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">120</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">% Msgs delivered</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">30%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">50%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">80%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Client Access Methods</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Webmail, ZCO</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">95%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">95%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">95%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAP</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">25%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">50%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mobile</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">25%</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">40%</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_role_based_server_hardware_configuration_and_placement">Role Based Server Hardware Configuration and Placement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This Reference Architecture for 1,000 Users provides client access via a load balanced Virtual IP address through redundant servers located in an Internet-facing security zone, typically called a DMZ.</p>
</div>
<div class="paragraph">
<p>MTA and Proxy services will be located on servers in the DMZ that are required to handle connectivity to the outside world.</p>
</div>
<div class="paragraph">
<p>The proxy service will offload SSL traffic and proxy all HTTP, POP, and IMAP traffic to the mailbox store services.</p>
</div>
<div class="paragraph">
<p>The Zimbra LDAP services will provide configuration information required to run the Zimbra Collaboration Suite.  Authentication Services can be provided by the Zimbra LDAP service, the customer’s Active Directory domain controllers, or an external LDAP service on a per domain basis.</p>
</div>
<div class="paragraph">
<p>The Mailbox Servers store email, calendar, address book, documents, and briefcase for each user. The Zimbra LDAP Servers, Mailbox Store Servers, and the Blackberry Enterprise Server (if required) will reside in the customer’s Internal Security Zone.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Server-Configuration-and-Placement.png" alt="Server Configuration and Placement" width="600">
</div>
<div class="title">Figure 1. Server Configuration and Placement</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_virtualization_strategy">Virtualization Strategy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All Zimbra Servers should be installed as guest operating systems running on VMware vSphere version 4.1 or higher. Guest systems should be configured according to Zimbra recommendations for Virtual Servers, which can be found <a href="http://wiki.zimbra.com/wiki/Performance_Recommendations_for_Virtualizing_Zimbra_with_VMware_vSphere_4">here</a>.</p>
</div>
<div class="sect2">
<h3 id="_memory_allocation">Memory Allocation</h3>
<div class="paragraph">
<p>Memory performance is affected by the processor/memory architecture provided by your hardware vendor. Some vendors create NUMA (Non Uniform Memory Access) boundaries that assign 8 GB of RAM per processor, while others may have a NUMA boundary at 12 GB per processor.</p>
</div>
<div class="paragraph">
<p>MTA/Proxy servers can usually function well with as little as 8 GB of RAM for all of the usage scenarios defined, but they function better with more memory. Mailbox servers that are also running LDAP services as shown should have a minimum of 16 GB of RAM and will require as much as 32 GB of RAM for the heavy usage scenario.</p>
</div>
<div class="paragraph">
<p>If possible, allocate processors and memory along NUMA boundaries for each virtual machine. For example, if your hardware architecture has NUMA boundaries at 12 GB per processor, you might allocate 2 processors with 12 GB of RAM for each MTA/Proxy and 2 processors with 24 GB of RAM for your LDAP/Mailbox server. For a hardware architecture with NUMA boundaries at 8 GB, you might allocate 2 processors with 8 GB of RAM for each MTA/proxy server and 2 processors with 32 GB of RAM for your mailbox server.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_storage_design">Storage Design</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Disk operations traditionally represent the bottleneck for performance in the Zimbra environment and have the biggest impact on the user experience. Since email is write intensive, dedicated, high performance drives in RAID 1 or RAID 1+0 configurations typically provide the best throughput.</p>
</div>
<div class="paragraph">
<p>Deployment of a SAN, while not required, provides the foundation for tools like vMotion to migrate virtual servers between physical servers and achieve High Availability goals. However, utilization of a SAN when used for multiple applications may create I/O contention and negatively impact Zimbra performance (i.e., if you have other applications running on the same SAN storage, it will negatively impact ZCS performance).</p>
</div>
<div class="paragraph">
<p>Customers should allocate storage from the SAN for the primary message store, index storage, MySQL database storage, and redolog storage for mailbox servers. Zimbra binaries, log files, secondary message storage, and backups will be allocated from the same storage. For MTA/Proxy services, all software can be installed as part of the root partition on allocated virtual disk.</p>
</div>
<div class="paragraph">
<p>Customer should use Hierarchical Storage Management (HSM) in Zimbra. Secondary message stores will be created on the SAN, configured as a separate datastore in VMware, and designated as the “current” secondary message store from the Zimbra Administration Console.  Secondary volumes can reside on lower costs, larger disks such as 750 GB 7200 RPM SATA drives.</p>
</div>
<div class="paragraph">
<p>While SAN performance varies with the amount of cache allocated to volume groups, a minimum number of spindles should be allocated to the volume groups used for the mailbox server in order to ensure adequate performance during normal loads.</p>
</div>
<div class="sect3">
<h4 id="_minimum_number_of_disk_spindles_for_primary_partition_store_index_db_redologtable">Minimum Number of Disk Spindles for Primary Partition (store, index, db, redolog)	Table</h4>
<table class="tableblock frame-all grid-rows" style="width: 60%;">
<colgroup>
<col style="width: 22.388%;">
<col style="width: 17.9104%;">
<col style="width: 37.3134%;">
<col style="width: 22.3882%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Disk RPM</th>
<th class="tableblock halign-left valign-top">Light</th>
<th class="tableblock halign-left valign-top">Medium</th>
<th class="tableblock halign-center valign-top">Heavy</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15000 (SAS)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10000 (SAS)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7200 (SATA)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">14</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Since backups can represent high IOPs requirements and must be completed during non-business hours, adequate IOPs capacity (disk spindles) must be allocated to the backup partitions. The backup partition should be on a separate physical SAN environment or physical RAID group.</p>
</div>
</div>
<div class="sect3">
<h4 id="_minimum_number_of_disk_spindles_for_backup_partition_optzimbrabackuptable">Minimum Number of Disk Spindles for Backup Partition (/opt/zimbra/backup)	Table</h4>
<table class="tableblock frame-all grid-rows" style="width: 60%;">
<colgroup>
<col style="width: 22.388%;">
<col style="width: 17.9104%;">
<col style="width: 37.3134%;">
<col style="width: 22.3882%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Disk RPM</th>
<th class="tableblock halign-left valign-top">Light</th>
<th class="tableblock halign-left valign-top">Medium</th>
<th class="tableblock halign-center valign-top">Heavy</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15000 (SAS)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10000 (SAS)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7200 (SATA)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>VMware Storage Pools will be defined and allocated from SAN Storage for each server as defined below.</p>
</div>
</div>
<div class="sect2">
<h3 id="_file_system_setup">File System Setup</h3>
<div class="paragraph">
<p>Please review the file system setup section of the wiki article “Performance Tuning Guidelines for Large Deployments” at</p>
</div>
<div class="paragraph">
<p><a href="http://wiki.zimbra.com/index.php?title=Performance_Tuning_Guidelines_for_Large_Deployments" class="bare">http://wiki.zimbra.com/index.php?title=Performance_Tuning_Guidelines_for_Large_Deployments</a></p>
</div>
<div class="paragraph">
<p>All the Zimbra mount-points should be mounted with the options –noatime.</p>
</div>
<div class="paragraph">
<p>All should be created with the minimum following ext3 options:
-j -O dir_index -J size=400 -m 2 -b 4096 –L &lt; label name &gt;</p>
</div>
<div class="paragraph">
<p>The following tune2fs options should be altered to prevent FS checks on reboot:
-c 0 -i 0</p>
</div>
</div>
<div class="sect2">
<h3 id="_proxymta_usable_storage">Proxy/MTA Usable Storage</h3>
<div class="paragraph">
<p>The Spool Directory of the MTA/Proxy Servers has to be sized to account for potential non-delivery conditions of external email domains or the next step in routing email.</p>
</div>
<div class="paragraph">
<p>Additional Disk Space must be allocated for OS files, ZCS, and log files. All OS, ZCS, logs, and data files can reside on the same partition. Since this is the most write intensive component of ZCS, the partition should be allocated on the fastest drives.</p>
</div>
<div class="paragraph">
<p>The following table shows estimated disk requirements for the MTA/Proxy Servers.</p>
</div>
<div class="sect3">
<h4 id="_mtaproxy_storage_table">MTA/Proxy Storage Table</h4>
<table class="tableblock frame-all grid-rows" style="width: 60%;">
<colgroup>
<col style="width: 22.388%;">
<col style="width: 17.9104%;">
<col style="width: 37.3134%;">
<col style="width: 22.3882%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Criteria</th>
<th class="tableblock halign-left valign-top">Light</th>
<th class="tableblock halign-left valign-top">Medium</th>
<th class="tableblock halign-center valign-top">Heavy</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spool</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Est. Spool Size Requirements Per Day (GB) Per MTA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">45</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">60</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OS/ZCS/Logs</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Est. Other Requirements Per MTA (GB)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">45</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">60</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Total Disk Space Recommended Per MTA</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>60</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>90</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>120</strong></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_mail_store">Mail Store</h3>
<div class="paragraph">
<p>Mailbox server storage can be created on a single partition (/opt/zimbra) or on multiple partitions. The benefit of having it on multiple partitions is that you are able to customize the configuration (RAID levels, file system types, etc.) based on optimization requirements, and the Zimbra Stats can provide detailed information by partition used in troubleshooting potential performance bottlenecks. The minimum partition segregation should at least be /opt/zimbra and /opt/zimbra/backup with the backup partition on separate physical hardware.</p>
</div>
<div class="paragraph">
<p>Another factor to consider is the use of Hierarchical Storage Management (HSM) that is part of the ZCS Network Edition. HSM allows you to put older, less frequently accessed email on slower, less expensive storage. The split between primary and secondary storage is configurable in the ZCS Admin Console.</p>
</div>
<div class="paragraph">
<p>In the example shown below, it is assumed that /opt/zimbra/store2 is the secondary storage.  If you do not plan to use secondary storage, create /opt/zimbra/store with the total disk space of /opt/zimbra/store and /opt/zimbra/store2 combined.
Most Linux distributions use a default file system of ext3 with a 4096 byte block size. If ext4 is available with an 8192 byte block size, this should reduce IO load and improve overall system performance. Using other file system types can be risky and is not recommended for this size implementation.</p>
</div>
<div class="paragraph">
<p>RAID 1 or RAID 1+0 is recommended for all partitions except the backup partition where RAID 5 is acceptable.</p>
</div>
<div class="paragraph">
<p>Important: DO NOT use direct NFS file systems for the db (mysql data) or /opt/zimbra/data (where LDAP data is stored) directories. You WILL experience data corruption eventually if you use NFS for these. You may use vmdk filesystems mounted over NFS partitions with vSphere since the disk subsystem behaves as a block based device to the OS.</p>
</div>
<div class="sect3">
<h4 id="_mailstore_storage_mb_table">Mailstore Storage (MB) Table</h4>
<table class="tableblock frame-all grid-rows" style="width: 60%;">
<colgroup>
<col style="width: 22.388%;">
<col style="width: 17.9104%;">
<col style="width: 37.3134%;">
<col style="width: 22.3882%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Criteria</th>
<th class="tableblock halign-left valign-top">Light</th>
<th class="tableblock halign-left valign-top">Medium</th>
<th class="tableblock halign-center valign-top">Heavy</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/zimbra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">50</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">50</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">50</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/zimbra/store</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">120</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">370</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">880</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/zimbra/store2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">670</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2080</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4990</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/zimbra/db</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">130</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">300</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/zimbra/index</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">620</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1470</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/zimbra/redolog</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">250</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">590</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/zimbra/backup (separate physical hardware)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1630</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5080</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">12190</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Total</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>2790</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>8580</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>20470</strong></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_archive_store_optional">Archive Store (Optional)</h3>
<div class="paragraph">
<p>Since Archiving is simply a message repository and does not support day-to-day user activity, separation of disk partitions is not necessary. The calculations here assume 365 days of data stored on the archive server. RAID 5 can be used on slower disks.</p>
</div>
<div class="sect3">
<h4 id="_archive_storage_mb_table">Archive Storage (MB) Table</h4>
<table class="tableblock frame-all grid-rows" style="width: 60%;">
<colgroup>
<col style="width: 22.388%;">
<col style="width: 17.9104%;">
<col style="width: 37.3134%;">
<col style="width: 22.3882%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Criteria</th>
<th class="tableblock halign-left valign-top">Light</th>
<th class="tableblock halign-left valign-top">Medium</th>
<th class="tableblock halign-center valign-top">Heavy</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/zimbra</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3617</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10212</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">22034</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/zimbra/backup (separate physical hardware)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3609</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10205</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">22027</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Total</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>7226</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>20417</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>44061</strong></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_network_design">Network Design</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_mail_flow">Mail Flow</h3>
<div class="paragraph">
<p>Mail flow for customers with an external spam filtering system is shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Mail-Flow.png" alt="Mail Flow" width="800">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_host_file">Host File</h3>
<div class="paragraph">
<p>The Host file for all the servers should include entries for all the ZCS servers.</p>
</div>
</div>
<div class="sect2">
<h3 id="_external_connectivity_load_balancer">External Connectivity – Load Balancer</h3>
<div class="paragraph">
<p>Load Balancers can manage connectivity to multiple Zimbra MTA/Proxy servers to improve uptime and distribute workloads in the ZCS deployment. Typically, a customer will create one or more A records that point to a Load Balancer IP address that represents the different network services offered by Zimbra such as POP3, IMAP, HTTPS, or SMTP. If you choose not to deploy a load balancer, you can use round-robin DNS with the A record pointing to each Zimbra MTA/Proxy server. This may result in a perception of downtime if one of the MTA/Proxy servers is taken offline for maintenance. The table below shows several examples of how customers may name the services they offer. A simple version of this would be to have all services reference the same name such as mail.customer.com.</p>
</div>
<div class="sect3">
<h4 id="_load_balancer_configuration_table">Load Balancer Configuration Table</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Service Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Process</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Virtual IP:Port</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Target Hosts</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">webmail.customer.com</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xxx.xxx.xxx.xxx:443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP Address of Proxies</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pop.customercom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xxx.xxx.xxx.xxx:110</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP Address of Proxies</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">imap.customer.com</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xxx.xxx.xxx.xxx:993</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP Address of Proxies</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">smtp.customer.com</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">xxx.xxx.xxx.xxx:25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP Address of Proxies</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_firewall_port_configuration">Firewall Port Configuration</h3>
<div class="paragraph">
<p>For the recommended configuration, MTA and Proxy services are located in a security zone that is exposed to the Internet and must handle connectivity to the outside world, typically called a DMZ. LDAP, Mailbox, Archiving, and BES services are usually located inside the trusted corporate network (trusted). The following tables show the ports that must be opened from the outside to the DMZ and between the DMZ and trusted networks. Connecting from the Outside (Internet) to the DMZ (Proxy/MTA)</p>
</div>
<div class="sect3">
<h4 id="_internet_to_dmz_firewall_ports_table">Internet to DMZ Firewall Ports Table</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Function</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Port</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP to MTA from external mail servers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connect to Zimbra Mail (if SSL offloaded by Load Balancer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP to Proxy server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAP to Proxy Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">143</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connect to Zimbra Mail over HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAP SSL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">993</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP SSL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">995</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Bidirectional between DMZ servers (Proxy/MTA) and Internal Servers (LDAP, Mailbox)</p>
</div>
</div>
<div class="sect3">
<h4 id="_dmz_to_trusted_firewall_ports_table">DMZ to Trusted Firewall Ports Table</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Function</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Port</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSH for Remote Server logs/Management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP from Mailbox server to MTA’s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MTA to LDAP Authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">389</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Syslogd from MTA to Mailbox server udp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">514</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LMTP from MTA&#8217;s to Mailbox Servers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7025</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Administration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7071</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Route Lookups (from Proxy to Mailbox)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7072</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pop Proxy to Mailbox Servers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAP Proxy to Mailbox Servers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7143</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAP Proxy to Mailbox Servers (SSL)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7993</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP Proxy to Mailbox Servers (SSL)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7995</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Note</strong>: BES servers will need connectivity outbound to Blackberry Infrastructure on port 3101 and connect to VIP (mail.customer.com, which forwards to proxy server) on 80 or 443.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_high_availability_considerations">High Availability Considerations</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ldap_servers">LDAP Servers</h3>
<div class="paragraph">
<p>ZCS requires a customized implementation OpenLDAP for directory Services. The version of OpenLDAP installed with Zimbra supports a Master/Replica Model. All writes to the directory must occur on the LDAP master. Writes are then pushed automatically to the LDAP replicas, which can be read by any Zimbra service. The customer’s implementation may include one master and optionally an LDAP replica server (if an archive server is installed separately), each installed as services on the mailbox servers and the archive server.
In the event of a failure of the LDAP master, normal read operations of the directory will provide uninterrupted access to Zimbra users for basic operations. Operations that will be limited include password changes, configuration changes to domains, class of services, or accounts. If the LDAP Master is unrecoverable, customer’s IT staff will need to promote the LDAP replica to master status and rebuild a new LDAP replica. Zimbra has posted instructions for promoting an LDAP replica to an LDAP master here:</p>
</div>
<div class="paragraph">
<p><a href="http://wiki.zimbra.com/index.php?title=Promoting_Replica_to_LDAP_Master" class="bare">http://wiki.zimbra.com/index.php?title=Promoting_Replica_to_LDAP_Master</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_proxymta_servers">Proxy/MTA Servers</h3>
<div class="paragraph">
<p>Proxy and MTA servers do not maintain long-term data during normal operations. While a single server is capable of handling the traffic based on the stated assumptions and the projected load for 1,000 users, two servers should be configured as VMware guest servers on separate physical hardware for this deployment to provide higher availability for overall operations. The affinity rules should be configured in vSphere to prevent both servers from being on the same host. Access to the services will be provided using the load balancer. A single server can therefore be down and services should continue uninterrupted. If performance monitoring indicates excessive load after appropriate tuning, customer may choose to add an additional virtual server for increased capacity.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mailbox_servers">Mailbox Servers</h3>
<div class="paragraph">
<p>While ZCS supports clustering with tools such as the RedHat Cluster Services and Veritas Clustering, a clustered solution adds complexity to the environment and does not protect against the most common hardware outage of disk failures. The Zimbra Mailbox and optional archive servers should not be implemented as a cluster; however, they should be configured as vSphere guest servers and subject to management utilizing vSphere such as VMware HA and DRS. High Availability for data can be achieved utilizing SAN based replication of the file systems to an alternate site.</p>
</div>
<div class="paragraph">
<p>Note: The configuration of SAN based replication is beyond the scope of this project and should be addressed separately.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_backup_storage_sizing">Backup Storage Sizing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most customers require the ability to restore messages up to 30 days old from backup. This means there should be up to 5 weeks of email data.</p>
</div>
<div class="paragraph">
<p>Zimbra does what is effectively a differential backup in order to achieve the functionality of a full backup. A "differential" backup works by hard linking message files that were already backed up in a previous backup and only copying new message files. So each full backup directory is self-contained, and the total number of copies of messages in the backup at any time is 1, irrespective of the number of Full Backups that are being retained.</p>
</div>
<div class="paragraph">
<p>Size of full backup = size of primary store + size of secondary store + size of MySQL db + size of Index.  It will grow at the exact same rate as the live data.</p>
</div>
<div class="paragraph">
<p>The total size required for backups is estimated in tables 3 and 4 for the mailbox and archive server in the row shown as /opt/zimbra/backup.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_archiving_or_e_discovery">Archiving or E-discovery</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Zimbra has the ability to archive all inbound and outbound messages for a designated mailbox to a separate archive mailbox. The Archiving and Discovery Zimlet will be installed on the mailbox server and the service will be enabled on the MTA/Proxy server to support archiving and discovery if this is required.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_split_domain_strategy">Split Domain Strategy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When performing a gradual migration of email from legacy email systems to Zimbra, it is necessary to be able to host and route email between email servers during the migration period. Split Domain is the concept of routing mail between two different mail systems for the same domain. Both the legacy email systems and Zimbra will host email for accounts in the @customer.com email domain and will need to be able to route mail for users on the other system.</p>
</div>
<div class="paragraph">
<p>For most implementations, the legacy mail system will act as the primary routing agent for inbound emails for the @customer.com email domain until the migration effort is complete. Configuration requirements are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Legacy system should be configured with an address space of customer.com (and other necessary recipient domains) and a forwarding address of the IP address of the mail.customer.com VIP (Zimbra MTA server).</p>
</li>
<li>
<p>The domain properties of customer.com on Zimbra should be modified to set zimbraMailTransport to smtp:legacyserver.customer.com:25
Outbound external email from Zimbra should be routed through the legacy system and relayed to the Spam filtering SMTP gateways. Inbound mail from the Internet to addresses hosted in Zimbra should be relayed by the spam filtering gateways through the legacy system to the Zimbra MTA. No configuration changes are required on spam filtering.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For additional discussion, please see the following article:</p>
</div>
<div class="paragraph">
<p><a href="http://wiki.zimbra.com/index.php?title=Split_Domain" class="bare">http://wiki.zimbra.com/index.php?title=Split_Domain</a></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-09-10 22:55:17 +08
</div>
</div>
</body>
</html>